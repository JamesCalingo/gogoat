const stations = [{
    "name": "South Station",
    "id": "place-south"
},
{
    "name": "Back Bay",
    "id": "place-bbsta"
},
{
    "name": "Ruggles",
    "id": "place-rugg"
},
{
    "name": "Forest Hills",
    "id": "place-forhl"
},
{
    "name": "Hyde Park",
    "id": "place-NEC-2203"
},
{
    "name": "Route 128",
    "id": "place-NEC-2173"
},
{
    "name": "Canton Junction",
    "id": "place-NEC-2139"
},
{
    "name": "Canton Center",
    "id": "place-SB-0156"
},
{
    "name": "Stoughton",
    "id": "place-SB-0189"
},
{
    "name": "Sharon",
    "id": "place-NEC-2108"
},
{
    "name": "Mansfield",
    "id": "place-NEC-2040"
},
{
    "name": "Attleboro",
    "id": "place-NEC-1969"
},
{
    "name": "South Attleboro",
    "id": "place-NEC-1969"
},
{
    "name": "Pawtucket/Central Falls",
    "id": "place-NEC-1891"
},
{
    "name": "Providence",
    "id": "place-NEC-1851"
},
{
    "name": "TF Green Airport",
    "id": "place-NEC-1768"
},
{
    "name": "Wickford Junction",
    "id": "place-NEC-1659"
},
{
    "name": "Readville",
    "id": "place-DB-0095"
},
{
    "name": "Endicott",
    "id": "place-FB-0109"
},
{
    "name": "Dedham Corporate Center",
    "id": "place-FB-0118"
},
{
    "name": "Islington",
    "id": "place-FB-0125"
},
{
    "name": "Norwood Depot",
    "id": "place-FB-0143"
},
{
    "name": "Norwood Central",
    "id": "place-FB-0148"
},
{
    "name": "Windsor Gardens",
    "id": "place-FB-0166"
},
{
    "name": "Walpole",
    "id": "place-FB-0191"
},
{
    "name": "Foxboro",
    "id": "place-FS-0049"
},
{
    "name": "Norfolk",
    "id": "place-FB-0230"
},
{
    "name": "Franklin",
    "id": "place-FB-0275"
},
{
    "name": "Forge Park/495",
    "id": "place-FB-0303"
},
{
    "name": "Roslindale Village",
    "id": "place-NB-0064"
},
{
    "name": "Bellevue",
    "id": "place-NB-0072"
},
{
    "name": "Highland",
    "id": "place-NB-0076"
},
{
    "name": "West Roxbury",
    "id": "place-NB-0080"
},
{
    "name": "Hersey",
    "id": "place-NB-0109"
},
{
    "name": "Needham Junction",
    "id": "place-NB-0120"
},
{
    "name": "Needham Center",
    "id": "place-NB-0127"
},
{
    "name": "Needham Heights",
    "id": "place-NB-0137"
},
{
    "name": "Lansdowne",
    "id": "place-WML-0025"
},
{
    "name": "Boston Landing",
    "id": "place-WML-0035"
},
{
    "name": "Newtonville",
    "id": "place-WML-0081"
},
{
    "name": "West Newton",
    "id": "place-WML-0091"
},
{
    "name": "Auburndale",
    "id": "place-WML-0102"
},
{
    "name": "Wellesley Farms",
    "id": "place-WML-0125"
},
{
    "name": "Wellesley Hills",
    "id": "place-WML-0135"
},
{
    "name": "Wellesley Square",
    "id": "place-WML-0147"
},
{
    "name": "Natick Center",
    "id": "place-WML-0177"
},
{
    "name": "West Natick",
    "id": "place-WML-0199"
},
{
    "name": "Framingham",
    "id": "place-WML-0214"
},
{
    "name": "Ashland",
    "id": "place-WML-0252"
},
{
    "name": "Southborough",
    "id": "place-WML-0274"
},
{
    "name": "Westborough",
    "id": "place-WML-0340"
},
{
    "name": "Grafton",
    "id": "place-WML-0364"
},
{
    "name": "Worcester",
    "id": "place-WML-0442"
},
{
    "name": "Newmarket",
    "id": "place-DB-2265"
},
{
    "name": "Uphams Corner",
    "id": "place-DB-2258"
},
{
    "name": "Four Corners/Geneva",
    "id": "place-DB-2249"
},
{
    "name": "Talbot Avenue",
    "id": "place-DB-2240"
},
{
    "name": "Morton Street",
    "id": "place-DB-2230"
},
{
    "name": "Blue Hill Avenue",
    "id": "place-DB-2222"
},
{
    "name": "Fairmount",
    "id": "place-DB-2205"
},
{
    "name": "JFK/UMass",
    "id": "place-jfk"
},
{
    "name": "Quincy Center",
    "id": "place-qnctr"
},
{
    "name": "Braintree",
    "id": "place-brntn"
},
{
    "name": "Weymouth Landing/East Braintree",
    "id": "place-GRB-0118"
},
{
    "name": "East Weymouth",
    "id": "place-GRB-0146"
},
{
    "name": "West Hingham",
    "id": "place-GRB-0162"
},
{
    "name": "Nantasket Junction",
    "id": "place-GRB-0183"
},
{
    "name": "Cohasset",
    "id": "place-GRB-0199"
},
{
    "name": "North Scituate",
    "id": "place-GRB-0233"
},
{
    "name": "Greenbush",
    "id": "place-GRB-0276"
},
{
    "name": "South Weymouth",
    "id": "place-PB-0158"
},
{
    "name": "Abington",
    "id": "place-PB-0194"
},
{
    "name": "Whitman",
    "id": "place-PB-0212"
},
{
    "name": "Hanson",
    "id": "place-PB-0245"
},
{
    "name": "Halifax",
    "id": "place-PB-0281"
},
{
    "name": "Kingston",
    "id": "place-KB-0351"
},
{
    "name": "Holbrook/Randolph",
    "id": "place-MM-0150"
},
{
    "name": "Montello",
    "id": "place-MM-0186"
},
{
    "name": "Brockton",
    "id": "place-MM-0200"
},
{
    "name": "Campello",
    "id": "place-MM-0219"
},
{
    "name": "Bridgewater",
    "id": "place-MM-0277"
},
{
    "name": "Middleborough/Lakeville",
    "id": "place-MM-0356"
},
{
    "name": "North Station",
    "id": "place-north"
},
{
    "name": "Chelsea",
    "id": "place-chels"
},
{
    "name": "River Works",
    "id": "place-ER-0099"
},
{
    "name": "Lynn",
    "id": "place-ER-0117"
},
{
    "name": "Swampscott",
    "id": "place-ER-0128"
},
{
    "name": "Salem",
    "id": "place-ER-0168"
},
{
    "name": "Beverly",
    "id": "place-ER-0183"
},
{
    "name": "North Beverly",
    "id": "place-ER-0208"
},
{
    "name": "Hamilton/Wenham",
    "id": "place-ER-0227"
},
{
    "name": "Ipswich",
    "id": "place-ER-0276"
},
{
    "name": "Rowley",
    "id": "place-ER-0312"
},
{
    "name": "Newburyport",
    "id": "place-ER-0362"
},
{
    "name": "Montserrat",
    "id": "place-GB-0198"
},
{
    "name": "Beverly Farms",
    "id": "place-GB-0229"
},
{
    "name": "Manchester",
    "id": "place-GB-0254"
},
{
    "name": "West Gloucester",
    "id": "place-GB-0296"
},
{
    "name": "Gloucester",
    "id": "place-GB-0316"
},
{
    "name": "Rockport",
    "id": "place-GB-0353"
},
{
    "name": "Malden Center",
    "id": "place-mlmnl"
},
{
    "name": "Oak Grove",
    "id": "place-ogmnl"
},
{
    "name": "Wyoming Hill",
    "id": "place-WR-0062"
},
{
    "name": "Melrose/Cedar Park",
    "id": "place-WR-0067"
},
{
    "name": "Melrose Highlands",
    "id": "place-WR-0075"
},
{
    "name": "Greenwood",
    "id": "place-WR-0085"
},
{
    "name": "Wakefield",
    "id": "place-WR-0099"
},
{
    "name": "Reading",
    "id": "place-WR-0120"
},
{
    "name": "North Wilmington",
    "id": "place-WR-0163"
},
{
    "name": "Ballardvale",
    "id": "place-WR-0205"
},
{
    "name": "Andover",
    "id": "place-WR-0228"
},
{
    "name": "Lawrence",
    "id": "place-WR-0264"
},
{
    "name": "Bradford",
    "id": "place-WR-0325"
},
{
    "name": "Haverhill",
    "id": "place-WR-0329"
},
{
    "name": "West Medford",
    "id": "place-NHRML-0055"
},
{
    "name": "Wedgemere",
    "id": "place-NHRML-0073"
},
{
    "name": "Anderson/Woburn",
    "id": "place-NHRML-0127"
},
{
    "name": "Wilmington",
    "id": "place-NHRML-0152"
},
{
    "name": "North Billerica",
    "id": "place-NHRML-0218"
},
{
    "name": "Lowell",
    "id": "place-NHRML-0254"
},
{
    "name": "Porter",
    "id": "place-portr"
},
{
    "name": "Belmont",
    "id": "place-FR-0064"
},
{
    "name": "Waverly",
    "id": "place-FR-0074"
},
{
    "name": "Waltham",
    "id": "place-FR-0098"
},
{
    "name": "Brandeis/Roberts",
    "id": "place-FR-0115"
},
{
    "name": "Kendal Green",
    "id": "place-FR-0132"
},
{
    "name": "Lincoln",
    "id": "place-FR-0167"
},
{
    "name": "Concord",
    "id": "place-FR-0201"
},
{
    "name": "West Concord",
    "id": "place-FR-0219"
},
{
    "name": "South Acton",
    "id": "place-FR-0253"
},
{
    "name": "Littleton/Route 495",
    "id": "place-FR-0301"
},
{
    "name": "Ayer",
    "id": "place-FR-0361"
},
{
    "name": "Shirley",
    "id": "place-FR-0394"
},
{
    "name": "North Leominster",
    "id": "place-FR-0451"
},
{
    "name": "Fitchburg",
    "id": "place-FR-0494"
},
{
    "name": "Watchusett",
    "id": "place-FR-3338"
},
{
    "name": "Porter",
    "id": "place-portr"
},
{
    "name": "JFK/UMass",
    "id": "place-jfk"
},
{
    "name": "Quincy Center",
    "id": "place-qnctr"
},
{
    "name": "Braintree",
    "id": "place-brntn"
},
{
    "name": "Oak Grove",
    "id": "place-ogmnl"
},
{
    "name": "Malden Center",
    "id": "place-mlmnl"
},
{
    "name": "Ruggles",
    "id": "place-rugg"
},
{
    "name": "Forest Hills",
    "id": "place-forhl"
}
]

stations.sort((a, b) => {
    if (a.name < b.name) return -1
    return 1
})

const origin = document.querySelector("#origin")
const info = document.querySelector(".info")

function createOption(station) {
    const option = document.createElement("option")
    option.textContent = station.name ? station.name : station
    option.value = station.name ? station.name : station
    return option
}

stations.forEach(station => {
    option = createOption(station)
    origin.appendChild(option)
})

let start = origin.value
let second = document.querySelector("#second")
let directions = ["Outbound", "Inbound"]

function findDestinations(stations, origin) {
    info.innerHTML = ""
    destination.innerHTML = "<option disabled display=\"none\" selected>Select a direction</option>"

    directions.forEach(direction => {
        option = createOption(direction)
        destination.appendChild(option)
    })
    second.hidden = false
    start = origin
}

function index(array, selected) {
    document.querySelector("#buttondiv").hidden = false
    return array.indexOf(selected)
}

function schedule(start) {
    const stop = stations.find(station => station.name === start)
    if (!stop) return
    let directionID = index(directions, destination.value)
    let currentTime = new Date().toTimeString().split(" ")[0].slice(0, 5)
    console.log(currentTime)
    fetch(`https://api-v3.mbta.com/schedules?sort=departure_time&page[limit]=1&filter[min_time]=${currentTime}&filter[stop]=${stop.id}&filter[direction_id]=${directionID}`)
        .then(res => {
            res.json()
                .then(data => {
                    console.log(data)
                    let next = data.data[0]
                    if (next) {
                        info.innerHTML = `Your train should be arriving arround<br>
                    <span class="time">${new Date(next.attributes.arrival_time ? next.attributes.arrival_time : next.attributes.departure_time).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}</span>`
                    }
                    else {
                        info.innerHTML = "No prediction found."
                    }
                })
        })
        .catch(err => console.error(err))
    second.hidden = true
    document.querySelector("#buttondiv").hidden = true
}

const button = document.querySelector(".search")
button.addEventListener("click", () => schedule(start))